<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Texas Hold'em First-Person</title>
<style>
  body { margin:0; background:#0a5; font-family:sans-serif; }
  canvas { display:block; margin:0 auto; background:#0a5; }
  #menu { text-align:center; padding:20px; color:white; }
  select, input { margin:5px; }
  button { margin-top:10px; padding:10px; }
</style>
</head>
<body>

<div id="menu">
  <h2>Texas Hold'em Setup</h2>
  <label>Bots: <input type="number" id="botCount" min="1" max="5" value="3"></label><br>
  <label>Buy-in: <input type="number" id="buyIn" value="1000"></label><br>
  <label>Small Blind: <input type="number" id="smallBlind" value="10"></label><br>
  <label>Big Blind: <input type="number" id="bigBlind" value="20"></label><br>
  <div id="botDifficulties"></div>
  <button onclick="startGame()">Start Game</button>
</div>

<canvas id="tableCanvas" width="900" height="600" style="display:none;"></canvas>

<script>
// ==== Menu Setup ====
const botDiffDiv = document.getElementById('botDifficulties');
document.getElementById('botCount').addEventListener('input', updateBotDiffs);
function updateBotDiffs() {
  const n = parseInt(document.getElementById('botCount').value);
  botDiffDiv.innerHTML = '';
  for(let i=1;i<=n;i++){
    botDiffDiv.innerHTML += `Bot ${i} Difficulty: 
      <select id="botDiff${i}">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select><br>`;
  }
}
updateBotDiffs();

// ==== Game Variables ====
let canvas, ctx;
let players = [];
let communityCards = [];
let currentPlayerIndex = 0;

// ==== Start Game ====
function startGame() {
  const botCount = parseInt(document.getElementById('botCount').value);
  const buyIn = parseInt(document.getElementById('buyIn').value);
  const smallBlind = parseInt(document.getElementById('smallBlind').value);
  const bigBlind = parseInt(document.getElementById('bigBlind').value);
  
  document.getElementById('menu').style.display = 'none';
  canvas = document.getElementById('tableCanvas');
  canvas.style.display = 'block';
  ctx = canvas.getContext('2d');
  
  // Setup players
  players = [{name:"You", chips:buyIn, isBot:false, cards:[]}];
  for(let i=1;i<=botCount;i++){
    const diff = document.getElementById(`botDiff${i}`).value;
    players.push({name:`Bot ${i}`, chips:buyIn, isBot:true, cards:[], difficulty:diff});
  }
  
  drawTable();
  dealCards();
  gameLoop();
}

// ==== Draw Table ====
function drawTable(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // green felt
  ctx.fillStyle="#0a5"; 
  ctx.fillRect(0,0,canvas.width,canvas.height);
  // oval table
  ctx.beginPath();
  ctx.ellipse(canvas.width/2, canvas.height/2, 400, 200, 0, 0, Math.PI*2);
  ctx.fillStyle="#088"; ctx.fill();
  // pot
  ctx.fillStyle="white"; ctx.font="20px sans-serif";
  ctx.fillText("Pot: 0", canvas.width/2 -30, canvas.height/2+5);
  // your chips
  ctx.fillText(players[0].name+" Chips: "+players[0].chips, canvas.width/2-40, canvas.height-30);
  // bot chips
  for(let i=1;i<players.length;i++){
    ctx.fillText(players[i].name+" Chips: "+players[i].chips, 50 + i*150, 50);
  }
  // Turn marker
  const turnPlayer = players[currentPlayerIndex];
  ctx.fillStyle="yellow";
  if(turnPlayer.isBot) ctx.fillText("→ "+turnPlayer.name+"'s turn", 50 + currentPlayerIndex*150, 30);
  else ctx.fillText("→ Your turn!", canvas.width/2-40, canvas.height-50);
}

// ==== Deal Cards ====
function dealCards(){
  players.forEach(p=>{
    p.cards = [
      {rank:Math.floor(Math.random()*13)+2,suit:"♠"},
      {rank:Math.floor(Math.random()*13)+2,suit:"♥"}
    ];
  });
}

// ==== Game Loop ====
function gameLoop(){
  const player = players[currentPlayerIndex];
  drawTable();
  if(player.isBot){
    setTimeout(()=>{botAction(player);}, 500);
  } else {
    alert("Your turn! (placeholder)"); 
    nextTurn();
  }
}

// ==== Next Turn ====
function nextTurn(){
  currentPlayerIndex = (currentPlayerIndex+1)%players.length;
  gameLoop();
}

// ==== Bot AI with Difficulty Tiers ====
function evaluateHandStrength(player, communityCards) {
  const cards = [...player.cards, ...communityCards];
  let ranks = {};
  for (let c of cards) ranks[c.rank] = (ranks[c.rank] || 0) + 1;
  const pairs = Object.values(ranks).filter(v => v >= 2).length;
  if (pairs >= 2) return 0.8;
  if (pairs === 1) return 0.6;
  return Math.random() * 0.4;
}

function botAction(bot){
  const strength = evaluateHandStrength(bot, communityCards);
  const rand = Math.random();
  let action = "call";
  if (bot.difficulty === "easy") {
    if (rand < 0.7) action = "call";
    else if (rand < 0.9) action = "fold";
    else action = "raise";
  } else if (bot.difficulty === "medium") {
    if (rand < 0.5) action = "call";
    else if (rand < 0.75) action = "raise";
    else action = "fold";
  } else if (bot.difficulty === "hard") {
    if (strength > 0.7) action = "raise";
    else if (strength > 0.4) action = (rand < 0.7) ? "call" : "raise";
    else action = (rand < 0.3) ? "raise" : "fold";
  }
  doAction(bot, action);
}

// ==== doAction placeholder ====
function doAction(bot, action){
  console.log(bot.name + " does: " + action);
  nextTurn();
}
</script>

</body>
</html>
